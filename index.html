<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Money Buddy ‚Äî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ & ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0e1116">
<link rel="apple-touch-icon" href="icons/icon-180.png">
<style>
:root{
  --bg:#0e1116;
  --card:#151a23;
  --muted:#778;
  --text:#eef2ff;
  --accent:#6ee7b7;
  --accent-2:#60a5fa;
  --danger:#fb7185;
  --warn:#fbbf24;
  --ok:#34d399;
  --border:#232b3a;
  --chip:#1e2632;
  --shadow: 0 10px 20px rgba(0,0,0,.3);
  --radius:14px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Noto Sans Thai",Tahoma;
  color:var(--text); background: radial-gradient(1200px 600px at 80% -10%, #1a2030 0%, #0e1116 60%);
}
.header{
  position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
  background: linear-gradient(180deg, rgba(20,24,32,.85), rgba(20,24,32,.6));
  border-bottom:1px solid var(--border);
}
.wrap{max-width:1100px; margin:0 auto; padding:18px}
.brand{display:flex; align-items:center; gap:12px}
.logo{
  width:40px; height:40px; display:grid; place-items:center;
  background: conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2), var(--warn), var(--accent));
  border-radius:12px;
  box-shadow:var(--shadow);
  color:#0d1320; font-weight:800;
}
.brand h1{font-size:18px; margin:0}
.sub{color:var(--muted); font-size:12px; margin-top:2px}

.toolbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
a.tab{
  text-decoration:none;
  padding:10px 14px; border-radius:999px; background:var(--chip); border:1px solid var(--border);
  cursor:pointer; color:var(--text); font-weight:600; font-size:14px; display:inline-block;
}
a.tab.active, a.tab[aria-current="true"]{background:linear-gradient(90deg, rgba(110,231,183,.15), rgba(96,165,250,.12)); border-color:#2f3a52}
.section{display:none}
.section.active{display:block}
.section:target{display:block}

.cards{display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:16px; margin:18px 0}
.card{
  background:linear-gradient(180deg, #151a23, #121720);
  border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow);
}
.card h3{margin:0 0 4px 0; font-size:14px; color:var(--muted)}
.kpi{font-size:24px; font-weight:800}
.mono{font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
.kpi.ok{color:var(--ok)} .kpi.warn{color:var(--warn)} .kpi.bad{color:var(--danger)}

.table-wrap{overflow:auto; border:1px solid var(--border); border-radius:12px}
table{width:100%; border-collapse:collapse; min-width:720px}
th,td{padding:12px; border-bottom:1px solid var(--border); text-align:left; font-size:14px}
th{background:#0f141d; position:sticky; top:0; z-index:1}
tr:hover td{background:#0f131b}

.footer{color:var(--muted); text-align:center; padding:28px}
.small{font-size:12px}

.badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:var(--chip); border:1px solid var(--border); font-size:12px}
.badge.ok{border-color:#1f5a48}
.right{margin-left:auto}
.flex{display:flex; gap:10px; align-items:center}
hr{border:none; border-top:1px solid var(--border); margin:16px 0}
</style>
</head>
<body>
<header class="header">
  <div class="wrap">
    <div class="brand">
      <div class="logo">‡∏ø</div>
      <div>
        <h1>Money Buddy (PWA)</h1>
        <div class="sub">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‚Ä¢ ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô ‚Ä¢ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</div>
      </div>
      <div class="right flex">
        <span id="today" class="badge"></span>
        <button class="right" id="toggleTheme" title="‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°">üåì</button>
      </div>
    </div>
    <div class="toolbar" role="tablist">
      <a class="tab active" href="#section-ledger" id="tab-ledger" role="tab" aria-controls="section-ledger" aria-selected="true">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</a>
      <a class="tab" href="#section-savings" id="tab-savings" role="tab" aria-controls="section-savings">‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a class="tab" href="#section-goal" id="tab-goal" role="tab" aria-controls="section-goal">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</a>
      <a class="tab" href="#section-export" id="tab-export" role="tab" aria-controls="section-export">‡∏™‡∏≥‡∏£‡∏≠‡∏á/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</a>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="cards">
    <div class="card">
      <h3>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
      <div class="kpi mono" id="kpiCashflow">‡∏ø0</div>
      <div class="small" id="kpiCashflowNote">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö - ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
    </div>
    <div class="card">
      <h3>‡∏¢‡∏≠‡∏î‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°</h3>
      <div class="kpi mono ok" id="kpiSavings">‡∏ø0</div>
      <div class="small">‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å‡∏≠‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>
    <div class="card">
      <h3>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô (30 ‡∏ß‡∏±‡∏ô)</h3>
      <div class="kpi mono warn" id="kpiDaily">‡∏ø0</div>
      <div class="small">‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
    </div>
  </div>

  <section id="section-ledger" class="section active" aria-labelledby="tab-ledger">
    <div class="grid grid-3">
      <div class="card">
        <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
        <div class="grid grid-2">
          <div>
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="txDate">
          </div>
          <div>
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
            <select id="txType">
              <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
              <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
            </select>
          </div>
          <div>
            <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
            <input type="text" id="txCat" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô / ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ / ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á">
          </div>
          <div>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="txAmount" min="0" step="0.01" placeholder="0.00">
          </div>
          <div class="grid">
            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
            <input type="text" id="txNote" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
          </div>
          <div class="grid">
            <label>&nbsp;</label>
            <button class="primary" id="addTx">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h3>
        <div class="grid grid-2">
          <div>
            <label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
            <input type="month" id="filterMonth">
          </div>
          <div>
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
            <select id="filterType">
              <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
              <option value="income">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
              <option value="expense">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
            </select>
          </div>
          <div>
            <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
            <input type="text" id="filterQuery" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‚Ä¶">
          </div>
          <div class="grid">
            <label>&nbsp;</label>
            <button id="clearFilter">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
          </div>
        </div>
        <hr>
        <div class="flex">
          <span class="badge">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö: <span id="sumIncome">‡∏ø0</span></span>
          <span class="badge">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢: <span id="sumExpense">‡∏ø0</span></span>
          <span class="badge ok">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="sumNet">‡∏ø0</span></span>
        </div>
      </div>

      <div class="card">
        <h3>‡∏ó‡∏¥‡∏õ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô</h3>
        <ul>
          <li>‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</li>
          <li>‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</li>
          <li>‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏¥‡∏™‡∏±‡∏¢</li>
        </ul>
        <hr>
        <div class="small">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà <b>‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ</b> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
      </div>
    </div>

    <div class="table-wrap card">
      <table id="txTable">
        <thead>
          <tr>
            <th style="width:110px">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
            <th style="width:90px">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
            <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
            <th style="width:140px">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
            <th style="width:80px">‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="section-savings" class="section" aria-labelledby="tab-savings">
    <div class="grid grid-3">
      <div class="card">
        <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</h3>
        <div class="grid grid-2">
          <div>
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="svDate">
          </div>
          <div>
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
            <select id="svType">
              <option value="deposit">‡∏ù‡∏≤‡∏Å</option>
              <option value="withdraw">‡∏ñ‡∏≠‡∏ô</option>
            </select>
          </div>
          <div>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="svAmount" min="0" step="0.01" placeholder="0.00">
          </div>
          <div>
            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
            <input type="text" id="svNote" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤">
          </div>
          <div class="grid">
            <label>&nbsp;</label>
            <button class="primary" id="addSv">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </div>
      </div>
      <div class="card">
        <h3>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h3>
        <div class="grid">
          <div class="badge">‡∏ù‡∏≤‡∏Å‡∏™‡∏∞‡∏™‡∏°: <span id="svIn">‡∏ø0</span></div>
          <div class="badge">‡∏ñ‡∏≠‡∏ô‡∏™‡∏∞‡∏™‡∏°: <span id="svOut">‡∏ø0</span></div>
          <div class="badge ok">‡∏¢‡∏≠‡∏î‡∏≠‡∏≠‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="svNet">‡∏ø0</span></div>
        </div>
      </div>
      <div class="card">
        <h3>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢ (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
        <div class="grid grid-2">
          <div>
            <label>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="svGoal" min="0" step="1" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50,000">
          </div>
          <div>
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</label>
            <div class="badge"><span id="svProgress">0%</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-wrap card">
      <table id="svTable">
        <thead>
          <tr>
            <th style="width:110px">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
            <th style="width:90px">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
            <th style="width:140px">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
            <th style="width:80px">‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="section-goal" class="section" aria-labelledby="tab-goal">
    <div class="grid grid-3">
      <div class="card">
        <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äú‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?‚Äù</h3>
        <div class="grid grid-2">
          <div>
            <label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="gcTarget" min="0" step="1" value="50000">
          </div>
          <div>
            <label>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="gcCurrent" min="0" step="1" value="0">
          </div>
          <div>
            <label>‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="gcPerDay" min="0" step="1" value="250">
          </div>
          <div>
            <label>‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="gcPerMonth" min="0" step="1" value="8000">
          </div>
          <div class="grid">
            <label>&nbsp;</label>
            <button class="primary" id="calcTime">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤</button>
          </div>
        </div>
        <hr>
        <div id="gcTimeResult" class="small"></div>
      </div>

      <div class="card">
        <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äú‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà/‡∏ß‡∏±‡∏ô?‚Äù</h3>
        <div class="grid grid-2">
          <div>
            <label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="ccTarget" min="0" step="1" value="10000">
          </div>
          <div>
            <label>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="ccCurrent" min="0" step="1" value="0">
          </div>
          <div>
            <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏±‡∏ô)</label>
            <input type="number" id="ccDays" min="1" step="1" value="40">
          </div>
          <div class="grid">
            <label>&nbsp;</label>
            <button class="primary" id="calcContribution">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏≠‡∏≠‡∏°/‡∏ß‡∏±‡∏ô</button>
          </div>
        </div>
        <hr>
        <div id="ccResult" class="small"></div>
      </div>

      <div class="card">
        <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô 40 ‡∏ß‡∏±‡∏ô / 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h3>
        <div class="grid grid-2">
          <div>
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô</label>
            <select id="planType">
              <option value="40">40 ‡∏ß‡∏±‡∏ô</option>
              <option value="180">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (180 ‡∏ß‡∏±‡∏ô)</option>
            </select>
          </div>
          <div>
            <label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="planTarget" min="0" step="1" value="10000">
          </div>
          <div class="grid">
            <label>&nbsp;</label>
            <button id="buildPlan">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô</button>
          </div>
        </div>
        <hr>
        <div class="table-wrap">
          <table id="planTable">
            <thead>
              <tr><th>#</th><th>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏° (‡∏ö‡∏≤‡∏ó)</th><th>‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏°</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <section id="section-export" class="section" aria-labelledby="tab-export">
    <div class="card">
      <h3>‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• & ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</h3>
      <div class="grid grid-2">
        <div>
          <button id="btnExport">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (JSON)</button>
        </div>
        <div class="grid">
          <input type="file" id="importFile" accept=".json">
          <button class="warn" id="btnImport">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</button>
        </div>
      </div>
      <hr>
      <button class="danger" id="btnWipe">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <div class="small" style="margin-top:8px">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</div>
    </div>
  </section>

  <div class="footer small">¬© <span id="year"></span> Money Buddy ‚Äî PWA</div>
</main>

<script>
// Register service worker for PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js');
  });
}

// Safe storage for iOS Private mode
const storage = (()=>{
  try{ const t='__mb_test__'; localStorage.setItem(t,'1'); localStorage.removeItem(t); return localStorage; }
  catch(e){ const mem={}; return {getItem:k=>mem[k]||null, setItem:(k,v)=>mem[k]=String(v), removeItem:k=>delete mem[k]}; }
})();

const fmt = new Intl.NumberFormat('th-TH', { style:'currency', currency:'THB', maximumFractionDigits: 0 });
const fmt2 = new Intl.NumberFormat('th-TH', { style:'currency', currency:'THB'});
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function todayStr(){
  const d = new Date();
  const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0'), dd = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${dd}`;
}
function monthStr(date){
  const d = date? new Date(date): new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
}

const LS_KEYS = { tx:'mb_tx', sv:'mb_sv', theme:'mb_theme' };
let tx = JSON.parse(storage.getItem(LS_KEYS.tx) || '[]');
let sv = JSON.parse(storage.getItem(LS_KEYS.sv) || '[]');

function applyTheme(){
  const t = storage.getItem(LS_KEYS.theme) || 'dark';
  document.documentElement.setAttribute('data-theme', t);
}
document.getElementById('toggleTheme').addEventListener('click', ()=>{
  const current = storage.getItem(LS_KEYS.theme) || 'dark';
  storage.setItem(LS_KEYS.theme, current==='dark'?'light':'dark');
  applyTheme();
});
applyTheme();

// Header
document.getElementById('today').textContent = new Date().toLocaleDateString('th-TH', { weekday:'short', day:'2-digit', month:'short', year:'numeric' });
document.getElementById('year').textContent = new Date().getFullYear();

// Hash tabs active state
function syncTabActive(){
  const id = location.hash || '#section-ledger';
  $$('.section').forEach(s=> s.classList.remove('active'));
  const tgt = document.querySelector(id);
  if(tgt) tgt.classList.add('active');

  $$('.tab').forEach(a=> a.removeAttribute('aria-current'));
  const tab = document.querySelector(`a.tab[href="${id}"]`);
  if(tab) tab.setAttribute('aria-current','true');
}
window.addEventListener('hashchange', syncTabActive);
syncTabActive();

// Ledger
document.getElementById('txDate').value = todayStr();
document.getElementById('filterMonth').value = monthStr();

function renderTx(){
  const month = document.getElementById('filterMonth').value;
  const type = document.getElementById('filterType').value;
  const q = (document.getElementById('filterQuery').value || '').toLowerCase();

  const tbody = document.querySelector('#txTable tbody');
  tbody.innerHTML = '';
  let income=0, expense=0;

  tx
  .filter(item=>{
    const keepMonth = (item.date||'').startsWith(month);
    const keepType = type==='all' || item.type===type;
    const text = (item.cat||'') + ' ' + (item.note||'');
    const keepQuery = !q || text.toLowerCase().includes(q);
    return keepMonth && keepType && keepQuery;
  })
  .sort((a,b)=> (a.date||'').localeCompare(b.date||''))
  .forEach((item)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.date||'-'}</td>
      <td><span class="badge ${item.type==='income'?'ok':''}">${item.type==='income'?'‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö':'‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'}</span></td>
      <td>${item.cat||'-'}</td>
      <td>${item.note||'-'}</td>
      <td class="mono">${fmt2.format(item.amount||0)}</td>
      <td><button class="danger" data-del="${item.id}">‡∏•‡∏ö</button></td>
    `;
    tbody.appendChild(tr);
    if(item.type==='income') income+=(item.amount||0); else expense+=(item.amount||0);
  });

  document.getElementById('sumIncome').textContent = fmt2.format(income);
  document.getElementById('sumExpense').textContent = fmt2.format(expense);
  document.getElementById('sumNet').textContent = fmt2.format(income - expense);
  document.getElementById('kpiCashflow').textContent = fmt2.format(income - expense);

  const now = new Date();
  const last30 = tx
    .filter(it=> it.type==='expense')
    .filter(it=>{
      const d = new Date(it.date);
      return (now - d) / (1000*60*60*24) <= 30;
    })
    .reduce((s,it)=> s+(it.amount||0), 0);
  document.getElementById('kpiDaily').textContent = fmt2.format(last30/30);
}
['change','keyup'].forEach(ev=>{
  document.getElementById('filterMonth').addEventListener(ev, renderTx);
  document.getElementById('filterType').addEventListener(ev, renderTx);
  document.getElementById('filterQuery').addEventListener(ev, renderTx);
});
document.getElementById('clearFilter').addEventListener('click', ()=>{
  document.getElementById('filterType').value='all';
  document.getElementById('filterQuery').value='';
  document.getElementById('filterMonth').value = monthStr();
  renderTx();
});

document.getElementById('addTx').addEventListener('click', ()=>{
  const date = document.getElementById('txDate').value || todayStr();
  const type = document.getElementById('txType').value;
  const cat = document.getElementById('txCat').value.trim() || (type==='income'?'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ':'‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ');
  const amount = Number(document.getElementById('txAmount').value);
  const note = document.getElementById('txNote').value.trim();
  if(!amount || amount<=0){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
  const item = { id:(crypto.randomUUID && crypto.randomUUID()) || String(Date.now()), date, type, cat, amount, note };
  tx.push(item);
  storage.setItem(LS_KEYS.tx, JSON.stringify(tx));
  document.getElementById('txAmount').value=''; document.getElementById('txNote').value='';
  renderTx();
});

document.querySelector('#txTable').addEventListener('click', (e)=>{
  const id = e.target?.dataset?.del;
  if(!id) return;
  if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')){
    tx = tx.filter(i=> i.id!==id);
    storage.setItem(LS_KEYS.tx, JSON.stringify(tx));
    renderTx();
  }
});

// Savings
document.getElementById('svDate').value = todayStr();
function renderSv(){
  const tbody = document.querySelector('#svTable tbody');
  tbody.innerHTML='';
  let dep=0, wit=0;
  sv.sort((a,b)=> (a.date||'').localeCompare(b.date||''))
    .forEach(item=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.date||'-'}</td>
        <td><span class="badge ${item.type==='deposit'?'ok':'warn'}">${item.type==='deposit'?'‡∏ù‡∏≤‡∏Å':'‡∏ñ‡∏≠‡∏ô'}</span></td>
        <td>${item.note||'-'}</td>
        <td class="mono">${fmt2.format(item.amount||0)}</td>
        <td><button class="danger" data-del="${item.id}">‡∏•‡∏ö</button></td>`;
      tbody.appendChild(tr);
      if(item.type==='deposit') dep+=(item.amount||0); else wit+=(item.amount||0);
    });
  const net = dep - wit;
  document.getElementById('svIn').textContent = fmt2.format(dep);
  document.getElementById('svOut').textContent = fmt2.format(wit);
  document.getElementById('svNet').textContent = fmt2.format(net);
  document.getElementById('kpiSavings').textContent = fmt2.format(net);

  const goal = Number(document.getElementById('svGoal').value||0);
  document.getElementById('svProgress').textContent = goal>0 ? (Math.min(100, Math.round(net/goal*100)) + '%') : '0%';
}
document.getElementById('addSv').addEventListener('click', ()=>{
  const date = document.getElementById('svDate').value || todayStr();
  const type = document.getElementById('svType').value;
  const amount = Number(document.getElementById('svAmount').value);
  const note = document.getElementById('svNote').value.trim();
  if(!amount || amount<=0){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
  sv.push({id:(crypto.randomUUID && crypto.randomUUID()) || String(Date.now()), date, type, amount, note});
  storage.setItem(LS_KEYS.sv, JSON.stringify(sv));
  document.getElementById('svAmount').value=''; document.getElementById('svNote').value='';
  renderSv();
});
document.querySelector('#svTable').addEventListener('click',(e)=>{
  const id = e.target?.dataset?.del;
  if(!id) return;
  if(confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')){
    sv = sv.filter(i=> i.id!==id);
    storage.setItem(LS_KEYS.sv, JSON.stringify(sv));
    renderSv();
  }
});
document.getElementById('svGoal').addEventListener('keyup', renderSv);

// Goal Calculators
document.getElementById('calcTime').addEventListener('click', ()=>{
  const target = Number(document.getElementById('gcTarget').value||0);
  const current = Number(document.getElementById('gcCurrent').value||0);
  const perDay = Number(document.getElementById('gcPerDay').value||0);
  const perMonth = Number(document.getElementById('gcPerMonth').value||0);

  const remaining = Math.max(0, target - current);
  let daysViaDaily = perDay>0 ? Math.ceil(remaining / perDay) : null;
  let daysViaMonthly = perMonth>0 ? Math.ceil(remaining / (perMonth/30)) : null;

  let out = '';
  out += `<div>‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å <b>${new Intl.NumberFormat('th-TH', {style:'currency', currency:'THB'}).format(remaining)}</b></div>`;
  if(daysViaDaily!==null) out += `<div>‡∏ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏•‡∏∞ <b>${new Intl.NumberFormat('th-TH', {style:'currency', currency:'THB'}).format(perDay)}</b> ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <b>${daysViaDaily}</b> ‡∏ß‡∏±‡∏ô</div>`;
  if(daysViaMonthly!==null) out += `<div>‡∏ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ <b>${new Intl.NumberFormat('th-TH', {style:'currency', currency:'THB'}).format(perMonth)}</b> ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <b>${daysViaMonthly}</b> ‡∏ß‡∏±‡∏ô (~ ${Math.ceil(daysViaMonthly/30)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</div>`;
  document.getElementById('gcTimeResult').innerHTML = out;
});

document.getElementById('calcContribution').addEventListener('click', ()=>{
  const target = Number(document.getElementById('ccTarget').value||0);
  const current = Number(document.getElementById('ccCurrent').value||0);
  const days = Math.max(1, Number(document.getElementById('ccDays').value||1));
  const remaining = Math.max(0, target - current);
  const perDay = remaining / days;
  const perWeek = perDay * 7;
  const perMonth = perDay * 30;
  const nf = new Intl.NumberFormat('th-TH', {style:'currency', currency:'THB'});
  document.getElementById('ccResult').innerHTML = `
    ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ <b>${nf.format(perDay)}</b> ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô,
    ‡∏´‡∏£‡∏∑‡∏≠ <b>${nf.format(perWeek)}</b> ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå,
    ‡∏´‡∏£‡∏∑‡∏≠ <b>${nf.format(perMonth)}</b> ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á <b>${nf.format(target)}</b> ‡πÉ‡∏ô <b>${days}</b> ‡∏ß‡∏±‡∏ô
  `;
});

document.getElementById('buildPlan').addEventListener('click', ()=>{
  const days = Number(document.getElementById('planType').value);
  const target = Number(document.getElementById('planTarget').value||0);
  const per = Math.ceil(target / days);
  let acc = 0;
  const tbody = document.querySelector('#planTable tbody');
  tbody.innerHTML = '';
  for(let i=1;i<=days;i++){
    const need = (i<days) ? per : (target - per*(days-1));
    acc += need;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i}</td><td class="mono">${new Intl.NumberFormat('th-TH', {style:'currency', currency:'THB'}).format(need)}</td><td class="mono">${new Intl.NumberFormat('th-TH', {style:'currency', currency:'THB'}).format(acc)}</td>`;
    tbody.appendChild(tr);
  }
});

// Init
renderTx();
renderSv();
</script>
</body>
</html>
